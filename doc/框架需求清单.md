# Android权限请求框架 - 需求清单

## 核心功能需求

### 1. 基础支持
- [x] 支持Activity上下文的权限请求
- [x] 支持Fragment上下文的权限请求
- [x] 支持单权限请求
- [x] 支持多权限批量请求
- [x] 基于Activity Result API实现

### 2. 权限状态处理
- [x] 支持"拒绝一次后解释"场景
- [x] 支持"永久拒绝后跳转设置"场景
- [x] 权限状态智能判断（已授权/首次拒绝/永久拒绝）
- [x] 避免重复申请已授权权限

### 3. 编程语言支持
- [x] Kotlin友好的API设计
- [x] Java兼容的API接口
- [x] 支持链式调用语法

### 4. 回调机制
- [x] onGranted：权限授权成功回调
- [x] onDenied：权限被拒绝回调
- [x] onPermanentlyDenied：权限被永久拒绝回调
- [x] onBeforeRequest：权限请求前回调

### 5. 依赖管理
- [x] 零依赖设计（仅依赖androidx.activity:activity-ktx ≥1.7）
- [x] 不依赖RxJava
- [x] 不依赖Kotlin-Coroutine（但可扩展支持）
- [x] 包体积增加 < 50KB

## 高级功能需求

### 6. Android版本适配
- [x] **Android 14+ 权限适配**
  - 部分媒体权限（READ_MEDIA_IMAGES, READ_MEDIA_VIDEO, READ_MEDIA_AUDIO）
  - 通知权限（POST_NOTIFICATIONS）
  - 前台服务权限细分
- [x] **Android 13权限适配**
  - 运行时通知权限
  - 细粒度媒体权限
- [x] **Android 12权限适配**
  - 大致位置权限选项
- [x] 向下兼容至Android 6.0

### 7. 权限组处理策略
- [x] **相关权限一起申请**
  - 位置权限组（粗略位置 + 精确位置）
  - 存储权限组（读取 + 写入）
  - 媒体权限组（图片 + 视频 + 音频）
- [x] **权限依赖关系处理**
  - 后台位置权限依赖前台位置权限
  - 某些权限必须同时授权才有意义

### 8. 可扩展性
- [x] 支持自定义权限解释UI
- [x] 支持自定义主题
- [x] 支持全局默认配置
- [x] 支持多语言（i18n）
- [x] 提供SPI接口供埋点/日志/灰度扩展
- [x] 权限请求频率限制

## 技术实现需求

### 9. 架构设计
- [x] 使用Activity Result API
- [x] RequestPermission合约（单权限）
- [x] RequestMultiplePermissions合约（多权限）
- [x] 建造者模式的API设计
- [x] 单例模式的管理器

### 10. 性能要求
- [x] 冷启动耗时 < 1ms
- [x] 无反射调用
- [x] 内存泄漏检测通过
- [x] 支持ProGuard/R8混淆

### 11. 测试覆盖
- [x] 单元测试覆盖率 ≥ 80%
- [x] 集成测试覆盖主要场景
- [x] 兼容性测试（Android 6.0-14）
- [x] 性能测试和内存泄漏测试

## 扩展模块需求

### 12. 协程扩展模块（可选）
- [x] `suspend fun PermissionRequest.await()`
- [x] `Flow<PermissionState>` 权限状态监听
- [x] 协程友好的API设计

### 13. 文档和示例
- [x] 完整的API文档（KDoc + Dokka）
- [x] 8个典型使用场景的Demo
- [x] 集成指南和迁移指南
- [x] 常见问题解答

## 发布需求

### 14. 开源发布
- [x] Maven Central发布
- [x] CI/CD自动化流水线
- [x] 语义化版本管理
- [x] 开源协议选择
- [x] Issue/PR模板配置